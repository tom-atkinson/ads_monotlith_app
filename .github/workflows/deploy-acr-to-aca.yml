name: Deploy ACR Image to Azure Container App

on:
    workflow_dispatch:
        inputs:
            image_tag:
                description: 'Image tag to deploy (e.g., latest, commit SHA)'
                required: false
                default: 'latest'

jobs:
    deploy:
        runs-on: ubuntu-latest

        steps:
            - name: Log in to Azure
              uses: azure/login@v1
              with:
                  creds: ${{ secrets.AZURE_CREDENTIALS }}

            - name: Deploy to Azure Container App
              uses: azure/container-apps-deploy-action@v1
              with:
                  resourceGroup: ${{ env.AZURE_RESOURCE_GROUP }}
                  containerAppName: ${{ env.AZURE_CONTAINER_APP_NAME }}
                  imageToDeploy: ${{ env.CONTAINER_REGISTRY }}.azurecr.io/${{ env.IMAGE_NAME }}:${{ github.event.inputs.image_tag }}
                  targetPort: 8080

            - name: Deployment summary
              run: |
                  echo "âœ… Deployment completed successfully"
                  echo "Container App: ${{ env.AZURE_CONTAINER_APP_NAME }}"
                  echo "Resource Group: ${{ env.AZURE_RESOURCE_GROUP }}"
                  echo "Image: ${{ env.CONTAINER_REGISTRY }}.azurecr.io/${{ env.IMAGE_NAME }}:${{ github.event.inputs.image_tag }}"
